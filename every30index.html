<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>毎日つぶやく独り言英語｜パターンプラクティス</title>
<style>
  :root{--cream:#fff7e6;--ink:#222;--accent:#f05a28;--ok:#2e7d32;--ng:#c62828;--card:#ffffff;--muted:#666;}
  html,body{margin:0;padding:0;background:var(--cream);color:var(--ink);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
  header{position:sticky;top:0;z-index:5;background:linear-gradient(0deg,#ff7f50,var(--accent));color:#fff;padding:10px 14px;display:flex;align-items:center;gap:12px}
  header h1{font-size:16px;font-weight:700;margin:0;line-height:1.2}
  header small{opacity:.9;display:block}
  .wrap{max-width:880px;margin:12px auto 64px;padding:0 12px}
  .toolbar{display:grid;grid-template-columns:1fr;gap:10px;margin:10px 0 14px}
  @media(min-width:720px){ .toolbar{grid-template-columns: 2fr 1fr 1fr 1fr } }
  select,button{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #ddd;background:#fff;font-size:16px}
  button.primary{background:var(--accent);color:#fff;border:none}
  button.ghost{background:#fff;border:1px solid #ddd}
  button:disabled{opacity:.5;pointer-events:none}
  .card{background:var(--card);border-radius:16px;box-shadow:0 6px 18px rgba(0,0,0,.06);padding:16px}
  .meta{display:flex;align-items:baseline;gap:10px;color:var(--muted);font-size:14px;margin-bottom:6px}
  .q-ja{color:#c2185b;margin:8px 0 2px;font-size:22px;line-height:1.35} /* 日本語訳を英語と同じサイズに */
  .q-en{font-size:22px;line-height:1.35;margin:8px 0 12px}
  .blank{border-bottom:3px solid #333; padding:0 2px}
  .choices{display:grid;gap:10px;margin-top:8px}
  .choice{background:#fff;border:2px solid #eee;border-radius:14px;padding:14px 16px;font-size:18px;text-align:center;cursor:pointer;transition:.15s}
  .choice:hover{transform:translateY(-1px)}
  .choice.correct{border-color:var(--ok);box-shadow:0 0 0 3px rgba(46,125,50,.12)}
  .choice.wrong{border-color:var(--ng);box-shadow:0 0 0 3px rgba(198,40,40,.1)}
  .feedback{margin-top:10px;font-weight:700}
  .feedback.ok{color:var(--ok)} .feedback.ng{color:var(--ng)}
  .footerBtns{margin-top:14px;display:grid;gap:10px;grid-template-columns:1fr}
  .scorebar{display:flex;gap:10px;align-items:center;margin:10px 0 0}
  .bar{height:10px;background:#eee;border-radius:999px;flex:1;overflow:hidden}
  .bar>span{display:block;height:100%;background:var(--ok);width:0%}
  .small{font-size:12px;color:var(--muted)}
  .pill{display:inline-block;background:#0000000d;border:1px solid #00000010;border-radius:999px;padding:4px 10px;margin-left:6px}
  .list{margin:6px 0 0;padding-left:18px}
</style>
</head>
<body>
<header>
  <div>
    <h1>毎日つぶやく独り言英語 <small>Pattern Practice / 4択クイズ</small></h1>
    <small>学習レベル：1日目〜30日目（主題で選択）</small>
  </div>
</header>

<div class="wrap">
  <div class="toolbar">
    <select id="daySelect" title="学習日を選択"></select>
    <button id="modeAll" class="ghost" title="全問モード">全問</button>
    <button id="modeWrong" class="ghost" title="誤答のみ復習">誤答復習</button>
    <button id="resetDay" class="ghost" title="この日の成績をリセット">成績リセット</button>
  </div>

  <div class="card" id="quizCard" aria-live="polite">
    <div class="meta">
      <div id="titlePill" class="pill"></div>
      <div id="countPill" class="pill"></div>
      <div id="scorePill" class="pill"></div>
    </div>

    <div class="q-ja" id="qJa">日本語訳が入ります</div>
    <div class="q-en" id="qEn">English sentence with a <span class="blank">blank</span>.</div>

    <div class="choices" id="choices"></div>
    <div id="feedback" class="feedback" role="status"></div>

    <div class="footerBtns">
      <button id="nextBtn" class="primary" title="次の問題へ">次へ ▶︎</button>
    </div>

    <div class="scorebar">
      <div class="bar"><span id="barFill"></span></div>
      <div class="small" id="progressText">0 / 0</div>
    </div>
  </div>
</div>

<script>
/* ========= ① 学習データ ========= */
const DATASET = [
  { day:1, theme:"体や心の状態をつぶやく", phrase:"I’m so ～（～だなぁ）",
    items:[
      {id:"001",en:"I'm so _____.",answer:"thirsty",ja:"喉が渇いたなぁ。"},
      {id:"002",en:"I'm so _____.",answer:"sleepy",ja:"眠いなぁ。"},
      {id:"003",en:"I'm so _____.",answer:"busy",ja:"忙しいなぁ。"}
    ]},
  { day:2, theme:"人の性格・性質をつぶやく", phrase:"You’re so ～（あなたは～だなぁ）",
    items:[
      {id:"001",en:"You're so _____.",answer:"smart",ja:"あなたは頭がいいなあ。"},
      {id:"002",en:"You're so _____.",answer:"nice",ja:"あなたは優しいなあ。"}
    ]}
];

/* ========= ② 状態管理 ========= */
const state = { day: 1, mode: "all", queue: [], idx: 0, lastResult: null };
const storeKey = d => `monotalk-v1-day${d}`;
function loadStore(day){ const raw = localStorage.getItem(storeKey(day)); return raw ? JSON.parse(raw) : {correct:[],wrong:[]}; }
function saveStore(day,data){ localStorage.setItem(storeKey(day), JSON.stringify(data)); }

/* ========= ③ ユーティリティ ========= */
function getDayData(day){ return DATASET.find(x=>x.day===day); }
function shuffle(arr){ return arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(p=>p[1]); }
function fillBlank(en, chunk){ return en.replace("_____", chunk); }

/* ========= ④ UI初期化 ========= */
const daySelect = document.getElementById("daySelect");
const qJa = document.getElementById("qJa");
const qEn = document.getElementById("qEn");
const choicesEl = document.getElementById("choices");
const feedbackEl = document.getElementById("feedback");
const nextBtn = document.getElementById("nextBtn");
const titlePill = document.getElementById("titlePill");
const countPill = document.getElementById("countPill");
const scorePill = document.getElementById("scorePill");
const barFill = document.getElementById("barFill");
const progressText = document.getElementById("progressText");
const modeAllBtn = document.getElementById("modeAll");
const modeWrongBtn = document.getElementById("modeWrong");
const resetBtn = document.getElementById("resetDay");

function populateDaySelect(){
  daySelect.innerHTML = DATASET.map(d=>`<option value="${d.day}">Day ${d.day}｜${d.theme}</option>`).join("");
}
function makeQueue(){
  const data = getDayData(state.day); const store = loadStore(state.day);
  const idsAll = data.items.map(i=>i.id);
  const idsWrong = data.items.filter(i=>store.wrong.includes(i.id)).map(i=>i.id);
  state.queue = (state.mode==="wrong" ? idsWrong : idsAll);
  state.idx = 0;
  if(state.queue.length===0){ state.mode="all"; modeAllBtn.classList.add("primary"); modeWrongBtn.classList.remove("primary"); state.queue = idsAll; }
}
function updateHeader(){
  const d = getDayData(state.day);
  titlePill.textContent = `Day ${d.day}｜${d.theme}｜${d.phrase}`;
  countPill.textContent = `Q ${Math.min(state.idx+1, state.queue.length)} / ${state.queue.length}`;
  const st = loadStore(state.day);
  scorePill.textContent = `正解:${st.correct.length}｜誤答:${st.wrong.length}`;
  const progress = state.queue.length? ((state.idx)/state.queue.length*100) : 0;
  barFill.style.width = `${progress}%`;
  progressText.textContent = `${state.idx} / ${state.queue.length}`;
}
function renderQuestion(){
  feedbackEl.textContent = ""; feedbackEl.className = "feedback";
  const d = getDayData(state.day);
  if(!d || d.items.length===0){ qJa.textContent="この日はまだ問題がありません。"; qEn.textContent="(No data yet)"; choicesEl.innerHTML=""; return; }
  const id = state.queue[state.idx]; const item = d.items.find(x=>x.id===id);
  qJa.textContent = item.ja;
  qEn.innerHTML = item.en.replace("_____", '<span class="blank">_____</span>');
  const opts = shuffle([item.answer, ...d.items.filter(i=>i.answer!==item.answer).map(i=>i.answer).slice(0,3)]);
  choicesEl.innerHTML = "";
  opts.forEach(opt=>{
    const btn = document.createElement("button"); btn.className = "choice"; btn.textContent = opt;
    btn.onclick = ()=>checkAnswer(opt, item); choicesEl.appendChild(btn);
  });
  updateHeader();
}
function checkAnswer(opt,item){
  const correct = (opt===item.answer); state.lastResult = correct ? "ok" : "ng";
  [...choicesEl.children].forEach(b=>{
    if(b.textContent===item.answer){ b.classList.add("correct"); }
    if(b.textContent===opt && !correct){ b.classList.add("wrong"); }
    b.disabled = true;
  });
  const st = loadStore(state.day);
  if(correct){
    feedbackEl.textContent = "正解です！よくできました。"; feedbackEl.classList.add("ok");
    if(!st.correct.includes(item.id)) st.correct.push(item.id);
    st.wrong = st.wrong.filter(id=>id!==item.id);
  }else{
    feedbackEl.textContent = `不正解。正解は「${item.answer}」。`; feedbackEl.classList.add("ng");
    if(!st.wrong.includes(item.id)) st.wrong.push(item.id);
    st.correct = st.correct.filter(id=>id!==item.id);
  }
  saveStore(state.day, st); updateHeader();
}
function next(){
  if(state.idx < state.queue.length-1){ state.idx++; renderQuestion(); }
  else{ feedbackEl.textContent = "本日の出題はここまで。お疲れさま！"; feedbackEl.className = "feedback ok"; qEn.innerHTML = "Complete ✅"; choicesEl.innerHTML = ""; }
}
function resetDay(){
  if(confirm("この日の成績（正解/誤答）をリセットしますか？")){
    saveStore(state.day, {correct:[], wrong:[]}); state.idx = 0; makeQueue(); renderQuestion();
  }
}

/* ========= ⑤ イベント ========= */
daySelect.addEventListener("change", e=>{
  state.day = parseInt(e.target.value,10); state.mode = "all";
  modeAllBtn.classList.add("primary"); modeWrongBtn.classList.remove("primary");
  makeQueue(); renderQuestion();
});
nextBtn.addEventListener("click", next);
modeAllBtn.addEventListener("click", ()=>{ state.mode="all"; modeAllBtn.classList.add("primary"); modeWrongBtn.classList.remove("primary"); makeQueue(); renderQuestion(); });
modeWrongBtn.addEventListener("click", ()=>{ state.mode="wrong"; modeWrongBtn.classList.add("primary"); modeAllBtn.classList.remove("primary"); makeQueue(); renderQuestion(); });
resetBtn.addEventListener("click", resetDay);

/* ========= ⑥ 起動 ========= */
(function init(){ populateDaySelect(); state.day = DATASET[0].day; daySelect.value = String(state.day); modeAllBtn.classList.add("primary"); makeQueue(); renderQuestion(); })();
</script>
</body>
</html>
